import{E as _,r as h,o as M,a as P,c as I,b as L,d as l,w as f,u as g,i as D,P as J,e as v,_ as x,f as S,F as B,g as $,h as R,j as w,k as W,l as F,m as H,n as U}from"./pnpm-eeed1aa5.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function c(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=c(n);fetch(n.href,s)}})();const V=(e,t=1e3)=>{let c=null;return function(){let i=this,n=arguments;c&&clearTimeout(c),c=setTimeout(function(){e.apply(i,n)},t)}},j={set(e,t){sessionStorage&&e!=null&&t!=null&&sessionStorage.setItem(e,t)},get(e){return!sessionStorage||e==null?null:sessionStorage.getItem(e)},setJSON(e,t){t!=null&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(t!=null)return JSON.parse(t)},remove(e){sessionStorage.removeItem(e)}},K={set(e,t){localStorage&&e!=null&&t!=null&&localStorage.setItem(e,t)},get(e){return!localStorage||e==null?null:localStorage.getItem(e)},setJSON(e,t){t!=null&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(t!=null)return JSON.parse(t)},remove(e){localStorage.removeItem(e)}},X={session:j,local:K},q={msg(e){_.info(e)},msgError(e){_.error(e)},msgSuccess(e){_.success(e)},msgWarning(e){_.warning(e)}},z={ADMIN_TOKEN:"ADMIN-TOKEN",H5:"h5",WX_XCX:"miniprogram",APP_PLUS:"plus"};h({currentCameraDeviceId:void 0,allCameraDevices:[]});function G(){const e=h(!1),t=h({});return{open:e,Cache:X,Constants:z,Modal:q,refsMap:t}}function N(e={}){const{accept:t=[".csv",".xlsx"]}=e;return new Promise(c=>{const i=document.createElement("input");i.type="file",i.accept=t.join(","),i.addEventListener("change",function(n){const s=n.target.files;s.length>0?c(s[0]):console.log("没有选择文件")}),i.click()})}const Q={style:{display:"flex",height:"100vh","flex-direction":"column","overflow-y":"hidden",margin:"1em 1em 0","box-sizing":"border-box"}},Y={style:{display:"flex",gap:"20px","justify-content":"center"}},Z={__name:"App",setup(e){const{refsMap:t}=G(),c=h("calc(100vh - 100px)");M(()=>{setTimeout(()=>{const r=t.value["system-table"],a=r.$el.getBoundingClientRect();console.log("table.$el",r.$el.offsetTop),c.value=`calc(100vh - ${a.top}px)`},2e3)});const i=[".xlsx",".csv"],n=h("first"),s=h([]),m=h([]);async function k(){try{const r=await N({accept:i});J.parse(r,{encoding:"gb2312",complete:a=>{let u=a.data.filter(o=>O(o[0].substring(0,5))&&o[11].trim()!=="交易关闭");m.value=u.map(o=>({time:(o[3]||o[2]).substring(10,15).replace(":",""),createTime:o[2],payTime:o[3],counterparty:o[7],amount:o[9],incomeOrExpenditure:o[10]}))}})}catch(r){console.error(r)}}async function E(){try{const r=await N({accept:i}),a=new v.Workbook;await a.xlsx.load(r),a.worksheets[0].eachRow({includeEmpty:!0},(o,p)=>{let d=x.clone(o._cells.map(y=>y.value));d[1]&&d[1]!=="日期"&&(s.value.push(d),A())})}catch(r){console.error(r)}}function O(r){return/^\d+$/.test(r)}function C(){let r=x.groupBy(s.value,"amount"),a=m.value.filter(p=>{let d=r[p.amount];return d?d.filter(b=>Math.abs(b.time-p.time)<3)?!1:(p.reason="间相差超过3分钟",console.log("支付宝时间相差超过3分组",p),!0):(console.log("支付宝没找到金额",p),p.reason="没找到金额",!0)});console.log("result",a);const u=new v.Workbook,o=u.addWorksheet("Sheet");o.properties.defaultRowHeight=20,o.columns=[{header:"交易创建时间",key:"createTime",width:22},{header:"付款时间",key:"payTime",width:22},{header:"交易对方",key:"counterparty",width:32},{header:"金额",key:"amount",width:20},{header:"收/支",key:"incomeOrExpenditure",width:10},{header:"原因",key:"reason",width:32}],o.addRows(a),T(u,`参考-${S(new Date,"yyyyMMddHHmmss")}.xlsx`)}function T(r,a){r.xlsx.writeBuffer().then(u=>{const o=new Blob([u],{type:""});B.saveAs(o,a)})}const A=V(function(){s.value=s.value.map(r=>({time:r[12].replace(/；|“|：|:|;|b/g,"").substring(0,5),date:`${S(r[1],"yyyy-MM-dd")} ${r[12].replace(/；|“|：|;|b/g,":")}`,objName:r[4],incomeAmount:r[8],disburseAmount:r[9],amount:r[8]+r[9]})),s.value.sort((r,a)=>a.time-r.time)});return(r,a)=>{const u=$,o=W,p=F,d=H,y=R;return P(),I("div",Q,[L("div",Y,[l(u,{onClick:E},{default:f(()=>[w("现金银行明细上传")]),_:1}),l(u,{onClick:k},{default:f(()=>[w("支付宝上传")]),_:1}),l(u,{onClick:C},{default:f(()=>[w("导出")]),_:1})]),l(y,{modelValue:g(n),"onUpdate:modelValue":a[0]||(a[0]=b=>D(n)?n.value=b:null)},{default:f(()=>[l(d,{label:"现金银行",name:"first"},{default:f(()=>[l(p,{border:"",data:g(s),stripe:"",ref:b=>g(t)["system-table"]=b,height:g(c)},{default:f(()=>[l(o,{prop:"date",label:"时间",width:"250"}),l(o,{prop:"objName",label:"对象名称",width:"250","show-overflow-tooltip":""}),l(o,{prop:"incomeAmount",label:"收入金额"}),l(o,{prop:"disburseAmount",label:"支出金额"}),l(o,{prop:"amount",label:"金额"})]),_:1},8,["data","height"])]),_:1}),l(d,{label:"支付宝",name:"second"},{default:f(()=>[l(p,{border:"",data:g(m),stripe:"",height:g(c)},{default:f(()=>[l(o,{prop:"createTime",label:"交易创建时间"}),l(o,{prop:"payTime",label:"付款时间"}),l(o,{prop:"counterparty",label:"交易对方","show-overflow-tooltip":""}),l(o,{prop:"amount",label:"金额（元）"}),l(o,{prop:"incomeOrExpenditure",label:"收/支"})]),_:1},8,["data","height"])]),_:1})]),_:1},8,["modelValue"])])}}};U(Z).mount("#app");
