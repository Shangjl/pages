import{r as m,o as N,c as T,a as O,b as f,w as p,E as w,_ as g,f as _,F as B,P as L,d as D,e as M,g as h,h as P}from"./pnpm-eaa51692.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function i(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(e){if(e.ep)return;e.ep=!0;const r=i(e);fetch(e.href,r)}})();const S=(y,l=1e3)=>{let i=null;return function(){let a=this,e=arguments;i&&clearTimeout(i),i=setTimeout(function(){y.apply(a,e)},l)}},U={style:{display:"flex",height:"100vh","flex-direction":"column"}},C={style:{display:"flex",gap:"20px","justify-content":"center"}},R={__name:"App",setup(y){const l=m(!1),i=m(!1),a=m([]),e=m([]);async function r(t){const n=new w.Workbook;return await n.xlsx.load(t),n.worksheets[0].eachRow({includeEmpty:!0},(o,u)=>{let c=g.clone(o._cells.map(b=>b.value));c[1]&&c[1]!=="日期"&&(a.value.push(c),E())}),!1}function d(t){return/^\d+$/.test(t)}function k(){let t=g.groupBy(a.value,"amount"),n=e.value.filter(u=>{let c=t[u.amount];return c?c.filter(A=>Math.abs(A.time-u.time)<3)?!1:(u.reason="间相差超过3分钟",console.log("支付宝时间相差超过3分组",u),!0):(console.log("支付宝没找到金额",u),u.reason="没找到金额",!0)});console.log("result",n);const s=new w.Workbook,o=s.addWorksheet("Sheet");o.properties.defaultRowHeight=20,o.columns=[{header:"交易创建时间",key:"createTime",width:22},{header:"付款时间",key:"payTime",width:22},{header:"交易对方",key:"counterparty",width:32},{header:"金额",key:"amount",width:20},{header:"收/支",key:"incomeOrExpenditure",width:10},{header:"原因",key:"reason",width:32}],o.addRows(n),v(s,`参考-${_(new Date,"yyyyMMddHHmmss")}.xlsx`)}function v(t,n){t.xlsx.writeBuffer().then(s=>{const o=new Blob([s],{type:""});B.saveAs(o,n)})}async function x(t){return L.parse(t,{encoding:"gb2312",complete:n=>{let s=n.data.filter(o=>d(o[0].substring(0,5))&&o[11].trim()!=="交易关闭");e.value=s.map(o=>({time:(o[3]||o[2]).substring(10,15).replace(":",""),createTime:o[2],payTime:o[3],counterparty:o[7],amount:o[9],incomeOrExpenditure:o[10]})),i.value=!0,console.log("filterAliData.value",e.value)}}),!1}const E=S(function(){a.value=a.value.map(t=>({time:t[12].replace(/；|“|：|:|;|b/g,"").substring(0,5),date:`${_(t[1],"yyyy-MM-dd")} ${t[12].replace(/；|“|：|;|b/g,":")}`,objName:t[4],incomeAmount:t[8],disburseAmount:t[9],amount:t[8]+t[9]})),a.value.sort((t,n)=>n.time-t.time),l.value=!0});return(t,n)=>{const s=D,o=M;return N(),T("div",U,[O("div",C,[f(o,{limit:1,beforeUpload:r},{default:p(()=>[f(s,null,{default:p(()=>[h("现金银行明细上传")]),_:1})]),_:1}),f(o,{limit:1,beforeUpload:x},{default:p(()=>[f(s,null,{default:p(()=>[h("支付宝上传")]),_:1})]),_:1}),f(s,{onClick:k},{default:p(()=>[h("导出")]),_:1})])])}}};P(R).mount("#app");
