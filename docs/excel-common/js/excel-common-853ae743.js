import{r as h,E as g,F as x,P as k,o as _,c as b,a as v,b as d,w as m,_ as E,f as C,d as P,e as p,g as N}from"./pnpm-d88ff304.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const l of t.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();h({currentCameraDeviceId:void 0,allCameraDevices:[]});function y(i={}){const{accept:r=[".csv",".xlsx"]}=i;return new Promise(s=>{const n=document.createElement("input");n.type="file",n.accept=r.join(","),n.addEventListener("change",function(e){const t=e.target.files;t.length>0?s(t[0]):console.log("没有选择文件")}),n.click()})}const L=(i,r=1e3)=>{let s=null;return function(){let n=this,e=arguments;s&&clearTimeout(s),s=setTimeout(function(){i.apply(n,e)},r)}};function S(i){const{columnsSetting:r,rows:s,fileName:n}=i,e=new g.Workbook,t=e.addWorksheet("Sheet");t.properties.defaultRowHeight=20,t.columns=r,t.addRows(s),e.xlsx.writeBuffer().then(l=>{const a=new Blob([l],{type:""});x.saveAs(a,n)})}function B(i){const{file:r,filter:s=()=>!0,map:n=e=>e}=i;return new Promise(e=>{const t=[],l=L(function(){e(t.filter(s).map(n))},50),a=new g.Workbook;a.xlsx.load(r).then(()=>{a.worksheets[0].eachRow({includeEmpty:!0},(o,c)=>{t.push(o.values),l()})})})}function D(i){const{file:r,filter:s=()=>!0,map:n=e=>e}=i;return new Promise(e=>{k.parse(r,{encoding:"gb2312",complete:t=>{const l=t.data;e(l.filter(s).map(n))}})})}const O={style:{display:"flex",height:"100vh","flex-direction":"column","justify-content":"center"}},A={style:{display:"flex",gap:"20px","justify-content":"center"}},F={__name:"App",setup(i){const r=[".xlsx",".csv"],s=h([]),n=h([]);async function e(){const a=await y({accept:r}),u=await D({file:a,filter:o=>{var c,f;return((f=(c=o==null?void 0:o[11])==null?void 0:c.trim)==null?void 0:f.call(c))==="交易成功"}});console.log("result",u)}async function t(){const a=await y({accept:r}),u=await B({file:a,filter:o=>{var c,f;return((f=(c=o==null?void 0:o[1])==null?void 0:c.trim)==null?void 0:f.call(c))==="Indeterminate"}});console.log("result",u)}function l(){let a=E.groupBy(s.value,"amount"),u=n.value.filter(o=>{let c=a[o.amount];return c?c.filter(w=>Math.abs(w.time-o.time)<3)?!1:(o.reason="间相差超过3分钟",console.log("支付宝时间相差超过3分组",o),!0):(console.log("支付宝没找到金额",o),o.reason="没找到金额",!0)});console.log("result",u),S({columnsSetting:[{header:"交易创建时间",key:"createTime",width:22},{header:"付款时间",key:"payTime",width:22},{header:"交易对方",key:"counterparty",width:32},{header:"金额",key:"amount",width:20},{header:"收/支",key:"incomeOrExpenditure",width:10},{header:"原因",key:"reason",width:32}],rows:u,fileName:`参考-${C(new Date,"yyyyMMddHHmmss")}.xlsx`})}return(a,u)=>{const o=P;return _(),b("div",O,[v("div",A,[d(o,{onClick:t},{default:m(()=>[p("现金银行明细上传")]),_:1}),d(o,{onClick:e},{default:m(()=>[p("支付宝上传")]),_:1}),d(o,{onClick:l},{default:m(()=>[p("导出")]),_:1})])])}}};N(F).mount("#app");
