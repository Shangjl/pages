import{o as y,c as _,a as c,F as w,E as k,P as V,m as E,u as F,b as N,d as A,w as f,e as d,f as m,i as b,t as z,g as v,h as S,j as D,k as L,r as g,_ as P,l as T,n as M,p as W}from"./pnpm-c85d9f41.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();const C={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function O(r,a){return y(),_("svg",C,a[0]||(a[0]=[c("path",{fill:"currentColor",d:"M544 864V672h128L512 480L352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0 1 64 624c0-123.136 93.12-223.488 212.608-237.248A239.81 239.81 0 0 1 512 192a239.87 239.87 0 0 1 235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 0 1-240 240c-5.376 0-10.56-1.28-16-1.6v1.6z"},null,-1)]))}const R={name:"ep-upload-filled",render:O},I=(r,a=1e3)=>{let s=null;return function(){let i=this,e=arguments;s&&clearTimeout(s),s=setTimeout(function(){r.apply(i,e)},a)}};function U(r){const{workbook:a,fileName:s}=r;a.xlsx.writeBuffer().then(i=>{const e=new Blob([i],{type:""});w.saveAs(e,s)})}function $(r){const{file:a,filter:s=()=>!0,map:i=e=>e}=r;return new Promise(e=>{const t=[],o=I(function(){e(t.filter(s).map(i))},50),n=new k.Workbook;n.xlsx.load(a).then(()=>{n.worksheets[0].eachRow({includeEmpty:!0},(u,p)=>{t.push(u.values),o()})})})}function j(r){const{file:a,filter:s=()=>!0,map:i=e=>e}=r;return new Promise(e=>{V.parse(a,{encoding:"gb2312",complete:t=>{const o=t.data;e(o.filter(s).map(i))}})})}const G={style:{display:"flex","justify-content":"space-around","align-items":"center"}},x={__name:"index",props:E({name:String,accept:{type:String,default:".xlsx, .xls, .csv"},filter:{type:Function,default:r=>!0},map:{type:Function,default:r=>r}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const a=r,s=F(r,"modelValue"),i=N(()=>s.value.length>0);async function e(t){const o=t.name;return(o.endsWith("xlsx")||o.endsWith("xls"))&&(s.value=await $({file:t,filter:a.filter,map:a.map})),o.endsWith("csv")&&(s.value=await j({file:t,filter:a.filter,map:a.map})),!1}return(t,o)=>{const n=R,l=S,u=D,p=L;return y(),A(p,{drag:"",accept:r.accept,"before-upload":e},{tip:f(()=>[c("div",G,[d(u,{disabled:"",modelValue:m(i),"onUpdate:modelValue":o[0]||(o[0]=h=>b(i)?i.value=h:null)},null,8,["modelValue"]),c("span",null,z(r.name),1)])]),default:f(()=>[d(l,{size:"3em"},{default:f(()=>[d(n)]),_:1}),o[1]||(o[1]=c("div",{class:"el-upload__text"},[v(" 拖拽上传 "),c("em",null,"点击上传")],-1))]),_:1},8,["accept"])}}};function H(r){const{workbook:a,systemDataAmountGroup:s,zhiFuBaoData:i}=r,e=a.addWorksheet("支付宝");e.properties.defaultRowHeight=20,e.columns=[{header:"交易号",key:"tradingNumber",width:40},{header:"付款时间",key:"payTime",width:25},{header:"交易对方",key:"tradingTarget",width:30},{header:"金额",key:"amount",width:10},{header:"收/支 ",key:"incomeExpenditure",width:10},{header:"原因 ",key:"reason",width:30}];const t=i.filter(o=>{const n=s[o[9]];if(!n)return console.error("支付宝数据没找到相同金额",o),o.reason="没找到相同金额",!0;const l=o[3].substring(10,15).replace(":","");return n.find(p=>{const h=parseInt(p.timeStr.replace(":","")),B=parseInt(l);return Math.abs(h-B)<3})?!1:(console.error("时间超过3分钟"),console.error("系统相同金额数据",n),console.error("支付宝数据",o),o.reason="时间超过3分钟",!0)}).map(o=>({tradingNumber:o[0],payTime:o[3],tradingTarget:o[7],amount:o[9],incomeExpenditure:o[10],reason:o.reason}));e.addRows(t)}const q={style:{display:"flex",height:"100vh","flex-direction":"column",gap:"2em",padding:"1em","box-sizing":"border-box"}},J={style:{display:"flex",gap:"20px"}},K={style:{display:"flex",gap:"20px"}},Z={style:{display:"flex","justify-content":"center"}},Q={__name:"App",setup(r){const a=g([]),s=g({zhiFuBaoData:[]});function i(){const e=P.groupBy(a.value,"amount"),t=new k.Workbook;H({workbook:t,systemDataAmountGroup:e,zhiFuBaoData:s.value.zhiFuBaoData}),U({workbook:t,fileName:"参考.xlsx"})}return(e,t)=>{const o=T;return y(),_("div",q,[c("div",J,[d(x,{name:"现金银行系统数据",modelValue:m(a),"onUpdate:modelValue":t[0]||(t[0]=n=>b(a)?a.value=n:null),filter:n=>{var l,u;return((u=(l=n==null?void 0:n[1])==null?void 0:l.trim)==null?void 0:u.call(l))==="Indeterminate"},map:n=>({date:n[2],accountName:n[5],incomeAmount:n[9],disburseAmount:n[10],orderRemark:n[13],amount:n[9]+n[10],dateStr:m(M)(n[2],"yyyy-MM-dd"),timeStr:n[13].replace(/[;；：“]/gi,":").substring(0,5)})},null,8,["modelValue","filter","map"])]),c("div",K,[d(x,{name:"支付宝",modelValue:m(s).zhiFuBaoData,"onUpdate:modelValue":t[1]||(t[1]=n=>m(s).zhiFuBaoData=n),filter:n=>{var l,u;return((u=(l=n==null?void 0:n[11])==null?void 0:l.trim)==null?void 0:u.call(l))==="交易成功"}},null,8,["modelValue","filter"])]),c("div",Z,[d(o,{type:"primary",size:"large",onClick:i},{default:f(()=>t[2]||(t[2]=[v("导出")])),_:1})])])}}};W(Q).mount("#app");
